!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.shortcodeTokenizer=e():t.shortcodeTokenizer=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){return"/"===t[1]?f:"/"===t[t.length-2]?p:l}function o(t){return t=t.replace(/(^['"]|['"]$)/g,""),/^\d+$/.test(t)?+t:/^\d+.\d+$/.test(t)?parseFloat(t):/^['"]?(true|false|yes|no)['"]?$/i.test(t)?(t=t.replace(/(^['"]|['"]$)/g,"").toLowerCase(),"true"===t||"yes"===t):"undefined"===t?"undefined"==typeof thisIsNotDefined?"undefined":u(thisIsNotDefined):"null"===t?null:t}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a="TEXT",h="ERROR",l="OPEN",f="CLOSE",p="SELF_CLOSING",c="[a-zA-Z][a-zA-Z0-9_-]*",y=c+"=\\d+\\.\\d+|"+c+"=\\d+|"+c+'="[^\\]"]*"|'+c+"='[^\\]']*'|"+c,d="(?:(?:"+y+")(?:(?!\\s+/?\\])\\s|))+",b="\\[\\/?[a-zA-Z][^\\]]+\\]",v="\\[("+c+")(\\s"+d+")?\\]",g="\\[("+c+")(\\s"+d+")?\\s?\\/\\]",m="\\[\\/("+c+")\\]",w=new RegExp(d.substring(0,d.length-1),"ig"),x=new RegExp(b,"i"),k=new RegExp(v,"i"),E=new RegExp(m,"i"),S=new RegExp(g,"i"),O=e.Token=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i(this,t),this.name=null,this.type=e,this.body=n,this.pos=r,this.children=[],this.params={},this.isClosed=e===p,this.init()}return s(t,[{key:"init",value:function(){if(this.type!==a&&this.type!==h){var t=this.matchBody();this.initName(t),t[2]&&this.initParams(t[2])}}},{key:"initName",value:function(t){this.name=t[1]}},{key:"initParams",value:function(t){var e=t.match(w);this.params=e.reduce(function(t,e){e=e.trim();var n=e.indexOf("=");return~n?t[e.substring(0,n)]=o(e.substring(n+1)):t[e]=!0,t},{})}},{key:"matchBody",value:function(){var t=void 0;if(this.type===f)t=E;else if(this.type===l)t=k;else{if(this.type!==p)throw new SyntaxError("Unknown token: "+this.type);t=S}var e=this.body.match(t);if(null===e)throw new SyntaxError("Invalid "+this.type+" token: "+this.body);return e}},{key:"canClose",value:function(t){return this.name===t.name}}]),t}(),C=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{strict:!0,skipWhiteSpace:!1};i(this,t),"boolean"==typeof n&&(n={strict:n,skipWhiteSpace:!1}),this.options=n,this.buf=null,this.originalBuf=null,this.pos=0,e&&this.input(e)}return s(t,[{key:"input",value:function(t){if("string"!=typeof t)throw new Error("Invalid input");return this.buf=this.originalBuf=t,this.pos=0,this}},{key:"reset",value:function(){return this.buf=this.originalBuf,this.pos=0,this}},{key:"tokens",value:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e&&this.input(e),"string"!=typeof this.buf)throw new Error("Invalid input");for(var t=[],i=[];null!==(t=this._next());)t=Array.isArray(t)?t:[t],i.push.apply(i,n(t));return i}},{key:"ast",value:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.tokens(e),i=[],t=[],r=null,o=void 0,s=!0,u=!1,c=void 0;try{for(var y,d=n[Symbol.iterator]();!(s=(y=d.next()).done);s=!0)if(o=y.value,o.type===a){if(this.options.skipWhiteSpace&&0===o.body.replace(/\s+/g,"").length)continue;r?r.children.push(o):t.push(o)}else if(o.type===l)r?(r.children.push(o),i.push(r),r=o):(r=o,t.push(r));else if(o.type===f)if(r&&o.canClose(r))r.isClosed=!0,r=i.pop();else{if(this.options.strict)throw new SyntaxError("Unmatched close token: "+o.body);var b=new O(h,o.body);r?r.children.push(b):t.push(b)}else{if(o.type!==p)throw new SyntaxError("Unknown token: "+o.type);r?r.children.push(o):t.push(o)}}catch(t){u=!0,c=t}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}if(r){if(this.options.strict)throw new SyntaxError("Unmatched open token: "+r.body);t.push(new O(h,o.body))}return t}},{key:"_next",value:function(){if(!this.buf)return null;var t=this.buf.match(x);if(null===t){var e=new O(a,this.buf,this.pos);return this.pos+=this.buf.length,this.buf=null,e}var n=[];return 0!==t.index&&n.push(new O(a,this.buf.substring(0,t.index),this.pos)),n.push(new O(r(t[0]),t[0],this.pos+t.index)),this.buf=this.buf.substring(t.index+t[0].length),this.pos+=t.index+t[0].length,0===this.buf.length&&(this.buf=null),n}},{key:"strict",get:function(){return console.warn("Deprecated: use options.strict instead"),this.options.strict},set:function(t){console.warn("Deprecated: use options.strict = "+t+" instead"),this.options.strict=t}}]),t}();e.default=C,Object.assign(C,{TEXT:a,ERROR:h,OPEN:l,CLOSE:f,SELF_CLOSING:p,rxParams:w,rxEnclosure:x,rxOpen:k,rxClose:E,rxSelfclosing:S})}])});
//# sourceMappingURL=shortcode-tokenizer.min.js.map
